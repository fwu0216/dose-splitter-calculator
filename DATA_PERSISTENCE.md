# 数据持久化机制说明

## 概述

放射性药物分装计算器现在使用客户端本地存储（localStorage）来保存用户数据，确保数据在服务器重启后仍然保持。

## 数据保存机制

### 保存位置
- **之前**: 服务器端 `saved_data.json` 文件
- **现在**: 客户端浏览器 localStorage

### 保存的数据内容
```json
{
  "nuclide": "F18",           // 选择的核素类型
  "init_time": "08:00",       // 初始活度时间
  "target_time": "08:20",     // 标定时间
  "init_activity": "50.0",    // 初始活度 (mCi)
  "init_volume": "5.0",       // 初始体积 (mL)
  "desired_dose": "10.0"      // 标定剂量 (mCi)
}
```

### 保存时机
- 用户修改任何输入字段时
- 切换核素选择时
- 点击计算按钮时
- 填充当前时间时
- 使用快速时间按钮时

### 数据恢复
- 页面加载时自动从localStorage恢复数据
- 恢复所有输入字段的值
- 恢复核素选择状态
- 如果有完整数据，自动执行计算

## 优势

1. **服务器独立性**: 数据保存在用户浏览器中，不受服务器重启影响
2. **实时保存**: 用户每次输入变化都会立即保存
3. **跨会话持久化**: 浏览器关闭后数据仍然保持
4. **隐私保护**: 数据只存储在用户本地，不会上传到服务器
5. **离线可用**: 即使网络断开，已保存的数据仍然可用

## 数据管理

### 清除数据
- 点击"清除保存数据"按钮
- 确认后会清除所有保存的数据并重置到默认值

### 数据限制
- localStorage有存储大小限制（通常5-10MB）
- 数据会一直保存，直到用户手动清除或清除浏览器数据

## 技术实现

### 前端 (JavaScript)
- 使用 `localStorage.setItem()` 保存数据
- 使用 `localStorage.getItem()` 读取数据
- 使用 `localStorage.removeItem()` 清除数据

### 后端 (Python)
- 移除了服务器端数据保存功能
- 移除了 `/api/saved-data` 端点
- 计算API不再自动保存数据

## 兼容性

- 支持所有现代浏览器
- 需要JavaScript支持
- 如果localStorage不可用，会回退到默认值

## 迁移说明

对于现有用户：
- 首次访问新版本时，会使用默认值
- 之前保存在服务器端的数据不会自动迁移
- 用户需要重新输入数据，之后会自动保存到本地
