# 产品需求文档 (PRD)
## 放射性药物分装计算器 Web应用

### 1. 项目概述

#### 1.1 项目背景
将现有的Pythonista移动端应用转换为Web应用，实现跨平台访问，提高用户体验和可访问性。

#### 1.2 项目目标
- 将Pythonista应用功能完整迁移到Web平台
- 提供响应式设计，支持桌面和移动设备
- 部署到Render平台，实现稳定可靠的在线服务
- 保持原有的计算精度和用户体验

#### 1.3 目标用户
- 核医学技术人员
- 放射科医生
- 核医学研究人员
- 相关医疗专业人员

### 2. 功能需求

#### 2.1 核心功能

##### 2.1.1 核素选择
- **功能描述**：支持F-18和C-11两种放射性核素的选择
- **技术要求**：
  - 提供直观的按钮式选择界面
  - 显示核素名称和用途（F-18 FDG, C-11 Choline）
  - 选择后自动更新相关计算参数
- **数据要求**：
  - F-18半衰期：109.7分钟
  - C-11半衰期：20.3分钟

##### 2.1.2 时间管理
- **初始活度时间**：
  - 提供时间选择器
  - 支持"填充当前时间（东八区当前时间）"快捷功能
  - 默认值：07:00
- **标定时间**：
  - 提供时间选择器
  - 支持快速时间调整按钮（+5min, +10min, +15min, +20min）
  - 默认值：07:30

##### 2.1.3 剂量计算
- **输入参数**：
  - 初始活度（mCi）
  - 初始体积（mL）
  - 目标剂量（mCi）
- **计算功能**：
  - 基于放射性衰变公式计算
  - 实时计算，输入变化时自动更新
  - 提供计算结果


##### 2.1.4 结果显示
- **主要结果**：
  - 所需抽取体积（mL）- 大字体显示
  - 当前活度（mCi）
  - 当前浓度（mCi/mL）
- **详细结果**：
  - 完整计算结果
  - 格式化显示，便于阅读

#### 2.2 辅助功能

##### 2.2.1 数据管理
- **数据保存**：自动保存用户输入的历史数据
- **数据恢复**：页面刷新后恢复上次的输入值
- **数据清除**：提供清空目标剂量的功能

##### 2.2.2 用户界面
- **响应式设计**：适配桌面和移动设备
- **直观布局**：分区显示不同功能模块
- **视觉反馈**：选中状态、计算结果突出显示

### 3. 技术需求

#### 3.1 前端技术栈
- **框架**：React.js 或 Vue.js
- **样式**：CSS3 + 响应式设计
- **UI组件**：Material-UI 或 Ant Design
- **状态管理**：React Hooks 或 Vue Composition API

#### 3.2 后端技术栈
- **语言**：Python
- **框架**：Flask 或 FastAPI
- **部署**：Render平台
- **数据存储**：本地JSON文件或轻量级数据库

#### 3.3 核心算法
```python
def decay_activity(initial_activity, elapsed_minutes, half_life):
    return initial_activity * (0.5 ** (elapsed_minutes / half_life))

def calculate_concentration(activity, volume):
    return activity / volume if volume else 0

def calculate_volume(dose, concentration):
    return dose / concentration if concentration else 0
```

### 4. 界面设计

#### 4.1 布局结构
1. **核素选择区域**（浅紫色背景）
   - 标题：选择核素
   - F-18和C-11选择按钮

2. **初始数据区域**（浅绿色背景）
   - 标题：初始数据
   - 初始活度时间选择器
   - 填充当前时间按钮
   - 初始活度和体积输入框

3. **分装设置区域**（浅橙色背景）
   - 标题：分装设置
   - 标定时间选择器
   - 快速时间调整按钮
   - 目标剂量输入框
   - 清空按钮

4. **计算结果区域**（浅蓝色背景）
   - 标题：计算结果
   - 主要结果：所需抽取体积（大字体）
   - 计算按钮
   - 详细结果显示区域

#### 4.2 响应式设计
- **桌面端**：多列布局，充分利用屏幕空间
- **平板端**：单列布局，适当调整间距
- **移动端**：垂直堆叠，优化触摸操作

### 5. 部署需求

#### 5.1 Render部署配置
- **服务类型**：Web Service
- **构建命令**：`pip install -r requirements.txt`
- **启动命令**：`python app.py`
- **环境变量**：配置必要的环境变量

#### 5.2 域名和SSL
- 配置自定义域名
- 启用HTTPS加密
- 设置适当的缓存策略

#### 5.3 监控和维护
- 设置健康检查端点
- 配置日志记录
- 设置错误监控

### 6. 安全考虑

#### 6.1 数据安全
- 输入验证和清理
- 防止XSS攻击
- 数据本地存储，不涉及敏感信息传输

#### 6.2 计算精度
- 确保浮点数计算精度
- 验证计算结果的准确性
- 提供适当的错误处理

### 7. 测试策略

#### 7.1 功能测试
- 核素选择功能测试
- 时间计算功能测试
- 剂量计算功能测试
- 数据保存和恢复测试

#### 7.2 兼容性测试
- 不同浏览器兼容性
- 不同设备尺寸适配
- 移动端触摸操作测试

#### 7.3 性能测试
- 页面加载速度
- 计算响应时间
- 内存使用情况

### 8. 项目里程碑

#### 8.1 第一阶段：基础功能开发（1-2周）
- 搭建项目框架
- 实现核心计算功能
- 完成基础界面开发

#### 8.2 第二阶段：界面优化（1周）
- 完善响应式设计
- 优化用户体验
- 添加动画和交互效果

#### 8.3 第三阶段：部署和测试（1周）
- 部署到Render平台
- 进行功能测试
- 性能优化

#### 8.4 第四阶段：上线和维护（持续）
- 正式上线
- 用户反馈收集
- 持续改进

### 9. 成功指标

#### 9.1 功能指标
- 所有核心功能正常工作
- 计算精度与原应用一致
- 响应时间 < 1秒

#### 9.2 用户体验指标
- 界面加载时间 < 3秒
- 移动端操作流畅
- 用户满意度 > 90%

#### 9.3 技术指标
- 99.9%的服务可用性
- 支持并发用户数 > 100
- 数据保存成功率 > 99%

### 10. 风险评估

#### 10.1 技术风险
- **计算精度问题**：通过充分测试和验证解决
- **浏览器兼容性**：使用现代Web标准，提供降级方案
- **性能问题**：优化代码和资源加载

#### 10.2 项目风险
- **时间延期**：合理规划，预留缓冲时间
- **需求变更**：保持与用户的良好沟通
- **部署问题**：提前测试部署流程

### 11. 附录

#### 11.1 原应用代码分析
- 核心算法已确认
- 界面布局已分析
- 数据流已梳理

#### 11.2 技术参考资料
- React.js官方文档
- Flask/FastAPI文档
- Render部署指南
- 响应式设计最佳实践

---

**文档版本**：v1.0  
**创建日期**：2025-08-21  
**最后更新**：2025-08-21  
**负责人**：武奕辰
